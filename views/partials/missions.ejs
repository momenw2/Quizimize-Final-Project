<!-- Missions Tab -->
<div id="missions" class="tab-content" style="display: none">
  <div class="missions-header">
    <h3>Group Missions</h3>
    <button class="btn btn-primary" onclick="createNewMission()">
      Create Mission
    </button>
  </div>

  <div class="missions-container">
    <div class="missions-stats">
      <div class="stat-card">
        <h5>Active Missions</h5>
        <span id="activeMissions">0</span>
      </div>
      <div class="stat-card">
        <h5>Completed</h5>
        <span id="completedMissions">0</span>
      </div>
      <div class="stat-card">
        <h5>Members Participating</h5>
        <span id="participatingMembers">0</span>
      </div>
    </div>

    <div id="missionsList" class="missions-list">
      <!-- Missions will be loaded here -->
    </div>
  </div>
</div>

<script>
  // Missions-specific JavaScript
  async function loadMissions() {
    try {
      const response = await fetch(`/groups/${groupId}/missions`);
      const missions = await response.json();
      renderMissions(missions);
      updateMissionStats(missions);
    } catch (error) {
      console.error("Error loading missions:", error);
    }
  }

  function updateMissionStats(missions) {
    const activeMissions = missions.filter(
      (mission) => mission.status === "active"
    ).length;
    const completedMissions = missions.filter(
      (mission) => mission.status === "completed"
    ).length;

    // You might need to fetch participating members count from another endpoint
    // For now, we'll set it to 0
    const participatingMembers = 0;

    getElement("activeMissions").textContent = activeMissions;
    getElement("completedMissions").textContent = completedMissions;
    getElement("participatingMembers").textContent = participatingMembers;
  }

  function renderMissions(missions) {
    const container = getElement("missionsList");
    if (container && missions) {
      if (missions.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i>üéØ</i>
            <p>No missions yet. Create your first mission!</p>
          </div>
        `;
        return;
      }

      container.innerHTML = missions
        .map(
          (mission) => `
          <div class="mission-card" data-mission-id="${mission._id}">
            <div class="mission-header">
              <h4>${mission.title}</h4>
              <span class="mission-status ${mission.status}">${
            mission.status
          }</span>
            </div>
            <div class="mission-content">
              <p>${mission.description}</p>
              <div class="mission-meta">
                <div class="mission-info">
                  <span class="info-item">
                    <i>‚≠ê</i>
                    ${mission.points} Points
                  </span>
                  <span class="info-item">
                    <i>‚ùì</i>
                    ${
                      mission.questions
                        ? mission.questions.length
                        : mission.duration * 5
                    } Questions
                  </span>
                  ${
                    mission.deadline
                      ? `
                    <span class="info-item">
                      <i>‚è∞</i>
                      ${formatDeadline(mission.deadline)}
                    </span>
                  `
                      : ""
                  }
                </div>
              </div>
            </div>
            <div class="mission-actions">
              <button class="btn btn-primary" onclick="joinMission('${
                mission._id
              }')">
                Join Mission
              </button>
              <button class="btn btn-secondary" onclick="viewMissionDetails('${
                mission._id
              }')">
                Details
              </button>
            </div>
          </div>
        `
        )
        .join("");
    }
  }

  function formatDeadline(deadline) {
    const deadlineDate = new Date(deadline);
    const now = new Date();
    const diffTime = deadlineDate - now;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    if (diffDays < 0) {
      return "Expired";
    } else if (diffDays === 0) {
      return "Today";
    } else if (diffDays === 1) {
      return "Tomorrow";
    } else if (diffDays <= 7) {
      return `${diffDays} days left`;
    } else {
      return deadlineDate.toLocaleDateString();
    }
  }

  function createNewMission() {
    alert("Create new mission functionality - would open a modal");
  }

  function joinMission(missionId) {
    console.log("Joining mission:", missionId);
    // Implement join mission logic
  }

  function viewMissionDetails(missionId) {
    console.log("Viewing mission details:", missionId);
    // Implement view mission details logic
  }

  // Helper function to get element
  function getElement(id) {
    return document.getElementById(id);
  }
</script>
