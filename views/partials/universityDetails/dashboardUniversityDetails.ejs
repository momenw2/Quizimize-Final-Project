<div id="dashboard" class="tab-content">
  <div class="info-card">
    <h2>Admin Dashboard</h2>
    <p>Manage your university and view analytics</p>
  </div>

  <!-- Dashboard Tabs Navigation -->
  <div class="info-card">
    <div class="dashboard-tabs-container">
      <ul class="dashboard-tabs">
        <li class="dashboard-tab active" data-dashboard-tab="university">
          University
        </li>
        <li class="dashboard-tab" data-dashboard-tab="faculty">Faculty</li>
        <li class="dashboard-tab" data-dashboard-tab="courses">Courses</li>
      </ul>
    </div>
  </div>

  <!-- Dashboard Tab Contents -->
  <div class="dashboard-tab-contents">
    <!-- University Tab -->
    <div id="dashboard-university" class="dashboard-tab-content active">
      <!-- Quick Stats -->
      <div class="info-card">
        <h3>Quick Statistics</h3>
        <div class="member-stats">
          <div class="stat-card">
            <div class="stat-number">
              <%= university.members ? university.members.length : 0 %>
            </div>
            <div>Total Members</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">
              <%= university.posts ? university.posts.length : 0 %>
            </div>
            <div>Total Posts</div>
          </div>
          <div class="stat-card">
            <div class="stat-number"><%= university.totalXP || 0 %></div>
            <div>Total XP</div>
          </div>
          <div class="stat-card">
            <div class="stat-number"><%= university.averageLevel || 1 %></div>
            <div>Avg Level</div>
          </div>
        </div>
      </div>

      <!-- Member Management -->
      <div class="info-card">
        <h3>Member Management</h3>
        <div class="admin-actions">
          <button class="btn btn-primary" onclick="showMemberManagement()">
            Manage Members
          </button>
          <button class="btn btn-secondary" onclick="showInviteModal()">
            Invite New Members
          </button>
          <button class="btn btn-info" onclick="exportMemberData()">
            Export Data
          </button>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="info-card">
        <h3>Recent Activity</h3>
        <% if (university.posts && university.posts.length > 0) { %>
        <div class="recent-activity">
          <% university.posts.slice(0, 5).forEach(post => { %>
          <div class="activity-item">
            <div class="activity-content">
              <strong><%= post.authorName || 'Admin' %></strong>
              posted: "<%= post.content.length > 100 ? post.content.substring(0,
              100) + '...' : post.content %>"
            </div>
            <div class="activity-meta">
              <%= new Date(post.createdAt).toLocaleDateString() %> • <%=
              post.likes ? post.likes.length : 0 %> likes • <%= post.comments ?
              post.comments.length : 0 %> comments
            </div>
          </div>
          <% }) %>
        </div>
        <% } else { %>
        <p style="text-align: center; color: #666; font-style: italic">
          No recent activity
        </p>
        <% } %>
      </div>

      <!-- University Settings -->
      <div class="info-card">
        <h3>University Settings</h3>
        <div class="admin-actions">
          <button class="btn btn-warning" onclick="showUniversitySettings()">
            Edit University Info
          </button>
          <button class="btn btn-danger" onclick="showDeleteModal()">
            Delete University
          </button>
        </div>
      </div>
    </div>

    <!-- Faculty Tab -->
    <div id="dashboard-faculty" class="dashboard-tab-content">
      <div class="info-card">
        <h3>Faculty Management</h3>
        <p>Manage faculties within your university</p>
        <div class="admin-actions">
          <button class="btn btn-primary" onclick="createNewFaculty()">
            Create New Faculty
          </button>
          <button class="btn btn-secondary" onclick="manageFaculties()">
            Manage Existing Faculties
          </button>
          <button class="btn btn-info" onclick="viewFacultyAnalytics()">
            View Faculty Analytics
          </button>
        </div>
      </div>

      <!-- Faculty Statistics -->
      <div class="info-card">
        <h3>Faculty Statistics</h3>
        <div class="member-stats">
          <div class="stat-card">
            <div class="stat-number" id="totalFaculties">
              <%= university.faculties ? university.faculties.length : 0 %>
            </div>
            <div>Total Faculties</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="activeFaculties">
              <%= university.faculties ? university.faculties.length : 0 %>
            </div>
            <div>Active Faculties</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Faculty Members</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Faculty Courses</div>
          </div>
        </div>
      </div>

      <!-- Recent Faculty Activity -->
      <div class="info-card">
        <h3>Faculty Overview</h3>
        <% if (university.faculties && university.faculties.length > 0) { %>
        <div class="faculties-list">
          <% university.faculties.forEach(faculty => { %>
          <div class="faculty-item">
            <h4><%= faculty.name %></h4>
            <% if (faculty.description) { %>
            <p><%= faculty.description %></p>
            <% } %>
            <div class="faculty-meta">
              Courses: <%= faculty.courses ? faculty.courses.length : 0 %> <% if
              (faculty.contactEmail) { %> • Contact: <%= faculty.contactEmail %>
              <% } %>
            </div>
          </div>
          <% }) %>
        </div>
        <% } else { %>
        <p style="text-align: center; color: #666; font-style: italic">
          No faculties created yet. Create your first faculty to get started.
        </p>
        <% } %>
      </div>
    </div>

    <!-- Courses Tab -->
    <div id="dashboard-courses" class="dashboard-tab-content">
      <div class="info-card">
        <h3>Course Management</h3>
        <p>Create and manage courses for your university</p>
        <div class="admin-actions">
          <button class="btn btn-primary" onclick="createNewCourse()">
            Create New Course
          </button>
          <button class="btn btn-secondary" onclick="manageCourses()">
            Manage Existing Courses
          </button>
          <button class="btn btn-info" onclick="viewCourseAnalytics()">
            View Course Analytics
          </button>
        </div>
      </div>

      <!-- Course Statistics -->
      <div class="info-card">
        <h3>Course Statistics</h3>
        <div class="member-stats">
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Total Courses</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Active Courses</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Enrolled Students</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Course Completions</div>
          </div>
        </div>
      </div>

      <!-- Course Overview -->
      <div class="info-card">
        <h3>Course Overview</h3>
        <p style="text-align: center; color: #666; font-style: italic">
          No courses created yet. Create your first course to get started.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Create Faculty Modal -->
<div id="createFacultyModal" class="modal" style="display: none">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Create New Faculty</h3>
      <span class="close" onclick="closeCreateFacultyModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="createFacultyForm">
        <div class="form-group">
          <label for="facultyName">Faculty Name *</label>
          <input
            type="text"
            id="facultyName"
            name="name"
            required
            maxlength="100"
            placeholder="Enter faculty name"
          />
          <div class="char-count" id="facultyNameCount">0/100 characters</div>
        </div>

        <div class="form-group">
          <label for="facultyDescription">Description</label>
          <textarea
            id="facultyDescription"
            name="description"
            rows="3"
            maxlength="500"
            placeholder="Enter faculty description (optional)"
          ></textarea>
          <div class="char-count" id="facultyDescriptionCount">
            0/500 characters
          </div>
        </div>

        <div class="form-group">
          <label for="facultyContactEmail">Contact Email</label>
          <input
            type="email"
            id="facultyContactEmail"
            name="contactEmail"
            maxlength="100"
            placeholder="Enter contact email (optional)"
          />
        </div>

        <div class="form-actions">
          <button
            type="button"
            class="btn btn-outline"
            onclick="closeCreateFacultyModal()"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">Create Faculty</button>
        </div>
      </form>
    </div>
  </div>
</div>

<style>
  /* Dashboard Styles */
  .dashboard-tabs-container {
    border-bottom: 1px solid #e0e0e0;
  }

  .dashboard-tabs {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 2rem;
  }

  .dashboard-tab {
    padding: 0.75rem 1rem;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
    font-weight: 500;
  }

  .dashboard-tab:hover {
    color: #4a90e2;
    border-bottom-color: #4a90e2;
  }

  .dashboard-tab.active {
    color: #4a90e2;
    border-bottom-color: #4a90e2;
  }

  .dashboard-tab-contents {
    margin-top: 1.5rem;
  }

  .dashboard-tab-content {
    display: none;
  }

  .dashboard-tab-content.active {
    display: block;
  }

  .member-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }

  .stat-card {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
    border: 1px solid #e9ecef;
  }

  .stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #4a90e2;
    margin-bottom: 0.5rem;
  }

  .admin-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    margin-top: 1rem;
  }

  .recent-activity {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1rem;
  }

  .activity-item {
    padding: 1rem;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    background: #f9f9f9;
  }

  .activity-content {
    margin-bottom: 0.5rem;
    line-height: 1.4;
  }

  .activity-meta {
    font-size: 0.9rem;
    color: #666;
  }

  .faculties-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .faculty-item {
    padding: 1rem;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    background: #f9f9f9;
  }

  .faculty-item h4 {
    margin: 0 0 0.5rem 0;
    color: #333;
  }

  .faculty-item p {
    margin: 0 0 0.5rem 0;
    color: #666;
  }

  .faculty-meta {
    font-size: 0.9rem;
    color: #888;
  }

  /* Modal Styles */
  .modal {
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-content {
    background: white;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid #e0e0e0;
  }

  .modal-header h3 {
    margin: 0;
    color: #333;
  }

  .close {
    font-size: 1.5rem;
    cursor: pointer;
    color: #666;
    transition: color 0.3s ease;
  }

  .close:hover {
    color: #333;
  }

  .modal-body {
    padding: 1.5rem;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #333;
  }

  .form-group input,
  .form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
    box-sizing: border-box;
  }

  .form-group input:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #4a90e2;
  }

  .char-count {
    font-size: 0.8rem;
    color: #666;
    margin-top: 0.25rem;
  }

  .form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
  }

  /* Button Styles */
  .btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
  }

  .btn-primary {
    background-color: #4a90e2;
    color: white;
  }

  .btn-primary:hover {
    background-color: #357abd;
  }

  .btn-secondary {
    background-color: #6c757d;
    color: white;
  }

  .btn-secondary:hover {
    background-color: #545b62;
  }

  .btn-info {
    background-color: #17a2b8;
    color: white;
  }

  .btn-info:hover {
    background-color: #138496;
  }

  .btn-warning {
    background-color: #ffc107;
    color: #212529;
  }

  .btn-warning:hover {
    background-color: #e0a800;
  }

  .btn-danger {
    background-color: #dc3545;
    color: white;
  }

  .btn-danger:hover {
    background-color: #c82333;
  }

  .btn-outline {
    background-color: transparent;
    color: #6c757d;
    border: 1px solid #6c757d;
  }

  .btn-outline:hover {
    background-color: #6c757d;
    color: white;
  }

  /* Info Card Styles */
  .info-card {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: 1px solid #e0e0e0;
  }

  .info-card h2 {
    margin: 0 0 0.5rem 0;
    color: #333;
  }

  .info-card h3 {
    margin: 0 0 1rem 0;
    color: #333;
    border-bottom: 2px solid #f0f0f0;
    padding-bottom: 0.5rem;
  }

  .info-card p {
    margin: 0;
    color: #666;
    line-height: 1.5;
  }
</style>

<script>
  // Dashboard-specific JavaScript
  document.addEventListener("DOMContentLoaded", function () {
    // Dashboard tabs functionality
    const dashboardTabs = document.querySelectorAll(".dashboard-tab");
    const dashboardTabContents = document.querySelectorAll(
      ".dashboard-tab-content"
    );

    dashboardTabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        const tabId = tab.getAttribute("data-dashboard-tab");

        // Remove active class from all dashboard tabs and contents
        dashboardTabs.forEach((t) => t.classList.remove("active"));
        dashboardTabContents.forEach((content) =>
          content.classList.remove("active")
        );

        // Add active class to clicked dashboard tab and corresponding content
        tab.classList.add("active");
        document.getElementById(`dashboard-${tabId}`).classList.add("active");
      });
    });

    // Faculty creation functionality
    const createFacultyForm = document.getElementById("createFacultyForm");
    if (createFacultyForm) {
      createFacultyForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        const formData = new FormData(this);
        const facultyData = {
          name: formData.get("name"),
          description: formData.get("description"),
          contactEmail: formData.get("contactEmail"),
        };

        // Validate required fields
        if (!facultyData.name.trim()) {
          alert("Faculty name is required");
          return;
        }

        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;

        try {
          submitBtn.textContent = "Creating...";
          submitBtn.disabled = true;

          const response = await fetch(
            `/universities/<%= university._id %>/faculties`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(facultyData),
            }
          );

          const result = await response.json();

          if (response.ok) {
            alert("Faculty created successfully!");
            closeCreateFacultyModal();
            // Refresh the page to show the new faculty
            window.location.reload();
          } else {
            alert(result.error || "Failed to create faculty");
          }
        } catch (error) {
          console.error("Error creating faculty:", error);
          alert("Error creating faculty. Please try again.");
        } finally {
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        }
      });

      // Character count for faculty name
      const facultyName = document.getElementById("facultyName");
      const nameCount = document.getElementById("facultyNameCount");
      if (facultyName && nameCount) {
        facultyName.addEventListener("input", function () {
          const length = this.value.length;
          nameCount.textContent = `${length}/100 characters`;
          nameCount.style.color = length > 100 ? "#e74c3c" : "#666";
        });
      }

      // Character count for faculty description
      const facultyDescription = document.getElementById("facultyDescription");
      const descCount = document.getElementById("facultyDescriptionCount");
      if (facultyDescription && descCount) {
        facultyDescription.addEventListener("input", function () {
          const length = this.value.length;
          descCount.textContent = `${length}/500 characters`;
          descCount.style.color = length > 500 ? "#e74c3c" : "#666";
        });
      }
    }

    // Close modal when clicking outside
    const modal = document.getElementById("createFacultyModal");
    if (modal) {
      window.addEventListener("click", function (e) {
        if (e.target === modal) {
          closeCreateFacultyModal();
        }
      });
    }
  });

  // Dashboard functions
  function showMemberManagement() {
    alert("Member management feature coming soon!");
    // This would open a modal or navigate to a member management page
  }

  function showInviteModal() {
    const inviteCode = "<%= university.inviteCode || 'N/A' %>";
    alert(
      `Invite Code: ${inviteCode}\n\nShare this code with others to join your university!`
    );
    // This would open a modal with invite options
  }

  function exportMemberData() {
    alert("Export feature coming soon!");
    // This would generate and download a CSV of member data
  }

  function showUniversitySettings() {
    alert("University settings feature coming soon!");
    // This would open a modal with university settings
  }

  function showDeleteModal() {
    const confirmed = confirm(
      "WARNING: This will permanently delete the university and all its data. This action cannot be undone. Are you sure?"
    );
    if (confirmed) {
      alert("Delete university feature coming soon!");
      // This would call an API to delete the university
    }
  }

  // Faculty creation functions
  function createNewFaculty() {
    const modal = document.getElementById("createFacultyModal");
    if (modal) {
      modal.style.display = "block";
      document.getElementById("createFacultyForm").reset();

      // Reset character counts
      document.getElementById("facultyNameCount").textContent =
        "0/100 characters";
      document.getElementById("facultyDescriptionCount").textContent =
        "0/500 characters";
    }
  }

  function closeCreateFacultyModal() {
    const modal = document.getElementById("createFacultyModal");
    if (modal) {
      modal.style.display = "none";
    }
  }

  function manageFaculties() {
    alert("Manage faculties feature coming soon!");
    // This would show a list of faculties with edit/delete options
  }

  function viewFacultyAnalytics() {
    alert("Faculty analytics feature coming soon!");
    // This would show detailed analytics for faculties
  }

  function createNewCourse() {
    alert("Create new course feature coming soon!");
    // This would open a modal or form to create a new course
  }

  function manageCourses() {
    alert("Manage courses feature coming soon!");
    // This would show a list of courses with edit/delete options
  }

  function viewCourseAnalytics() {
    alert("Course analytics feature coming soon!");
    // This would show detailed analytics for courses
  }
</script>
