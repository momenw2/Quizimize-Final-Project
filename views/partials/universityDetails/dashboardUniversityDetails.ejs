<div id="dashboard" class="tab-content">
  <div class="info-card">
    <h2>Admin Dashboard</h2>
    <p>Manage your university and view analytics</p>
  </div>

  <!-- Dashboard Tabs Navigation -->
  <div class="info-card">
    <div class="dashboard-tabs-container">
      <ul class="dashboard-tabs">
        <li class="dashboard-tab active" data-dashboard-tab="university">
          University
        </li>
        <li class="dashboard-tab" data-dashboard-tab="institute">Institute</li>
        <li class="dashboard-tab" data-dashboard-tab="courses">Courses</li>
      </ul>
    </div>
  </div>

  <!-- Dashboard Tab Contents -->
  <div class="dashboard-tab-contents">
    <!-- University Tab -->
    <div id="dashboard-university" class="dashboard-tab-content active">
      <!-- Quick Stats -->
      <div class="info-card">
        <h3>Quick Statistics</h3>
        <div class="member-stats">
          <div class="stat-card">
            <div class="stat-number">
              <%= university.members ? university.members.length : 0 %>
            </div>
            <div>Total Members</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">
              <%= university.posts ? university.posts.length : 0 %>
            </div>
            <div>Total Posts</div>
          </div>
          <div class="stat-card">
            <div class="stat-number"><%= university.totalXP || 0 %></div>
            <div>Total XP</div>
          </div>
          <div class="stat-card">
            <div class="stat-number"><%= university.averageLevel || 1 %></div>
            <div>Avg Level</div>
          </div>
        </div>
      </div>

      <!-- Member Management -->
      <div class="info-card">
        <h3>Member Management</h3>
        <div class="admin-actions">
          <button class="btn btn-primary" onclick="showMemberManagement()">
            Manage Members
          </button>
          <button class="btn btn-secondary" onclick="showInviteModal()">
            Invite New Members
          </button>
          <button class="btn btn-info" onclick="exportMemberData()">
            Export Data
          </button>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="info-card">
        <h3>Recent Activity</h3>
        <% if (university.posts && university.posts.length > 0) { %>
        <div class="recent-activity">
          <% university.posts.slice(0, 5).forEach(post => { %>
          <div class="activity-item">
            <div class="activity-content">
              <strong><%= post.authorName || 'Admin' %></strong>
              posted: "<%= post.content.length > 100 ? post.content.substring(0,
              100) + '...' : post.content %>"
            </div>
            <div class="activity-meta">
              <%= new Date(post.createdAt).toLocaleDateString() %> • <%=
              post.likes ? post.likes.length : 0 %> likes • <%= post.comments ?
              post.comments.length : 0 %> comments
            </div>
          </div>
          <% }) %>
        </div>
        <% } else { %>
        <p style="text-align: center; color: #666; font-style: italic">
          No recent activity
        </p>
        <% } %>
      </div>

      <!-- University Settings -->
      <div class="info-card">
        <h3>University Settings</h3>
        <div class="admin-actions">
          <button class="btn btn-warning" onclick="showUniversitySettings()">
            Edit University Info
          </button>
          <button class="btn btn-danger" onclick="showDeleteModal()">
            Delete University
          </button>
        </div>
      </div>
    </div>

    <!-- Institute Tab -->
    <div id="dashboard-institute" class="dashboard-tab-content">
      <div class="info-card">
        <h3>Institute Management</h3>
        <p>Manage institutes within your university</p>
        <div class="admin-actions">
          <button class="btn btn-primary" onclick="createNewInstitute()">
            Create New Institute
          </button>
          <button class="btn btn-secondary" onclick="manageInstitutes()">
            Manage Existing Institutes
          </button>
          <button class="btn btn-info" onclick="viewInstituteAnalytics()">
            View Institute Analytics
          </button>
        </div>
      </div>

      <!-- Institute Statistics -->
      <div class="info-card">
        <h3>Institute Statistics</h3>
        <div class="member-stats">
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Total Institutes</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Active Institutes</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Institute Members</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Institute Courses</div>
          </div>
        </div>
      </div>

      <!-- Recent Institute Activity -->
      <div class="info-card">
        <h3>Institute Overview</h3>
        <p style="text-align: center; color: #666; font-style: italic">
          No institutes created yet. Create your first institute to get started.
        </p>
      </div>
    </div>

    <!-- Courses Tab -->
    <div id="dashboard-courses" class="dashboard-tab-content">
      <div class="info-card">
        <h3>Course Management</h3>
        <p>Create and manage courses for your university</p>
        <div class="admin-actions">
          <button class="btn btn-primary" onclick="createNewCourse()">
            Create New Course
          </button>
          <button class="btn btn-secondary" onclick="manageCourses()">
            Manage Existing Courses
          </button>
          <button class="btn btn-info" onclick="viewCourseAnalytics()">
            View Course Analytics
          </button>
        </div>
      </div>

      <!-- Course Statistics -->
      <div class="info-card">
        <h3>Course Statistics</h3>
        <div class="member-stats">
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Total Courses</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Active Courses</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Enrolled Students</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">0</div>
            <div>Course Completions</div>
          </div>
        </div>
      </div>

      <!-- Course Overview -->
      <div class="info-card">
        <h3>Course Overview</h3>
        <p style="text-align: center; color: #666; font-style: italic">
          No courses created yet. Create your first course to get started.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Create Institute Modal -->
<div id="createInstituteModal" class="modal" style="display: none">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Create New Institute</h3>
      <span class="close" onclick="closeCreateInstituteModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="createInstituteForm">
        <div class="form-group">
          <label for="instituteName">Institute Name *</label>
          <input
            type="text"
            id="instituteName"
            name="name"
            required
            maxlength="100"
            placeholder="Enter institute name"
          />
          <div class="char-count" id="instituteNameCount">0/100 characters</div>
        </div>

        <div class="form-group">
          <label for="instituteDescription">Description</label>
          <textarea
            id="instituteDescription"
            name="description"
            rows="3"
            maxlength="500"
            placeholder="Enter institute description (optional)"
          ></textarea>
          <div class="char-count" id="instituteDescriptionCount">
            0/500 characters
          </div>
        </div>

        <div class="form-group">
          <label for="instituteDirector">Director Name</label>
          <input
            type="text"
            id="instituteDirector"
            name="director"
            maxlength="50"
            placeholder="Enter director name (optional)"
          />
        </div>

        <div class="form-group">
          <label for="instituteContactEmail">Contact Email</label>
          <input
            type="email"
            id="instituteContactEmail"
            name="contactEmail"
            maxlength="100"
            placeholder="Enter contact email (optional)"
          />
        </div>

        <div class="form-actions">
          <button
            type="button"
            class="btn btn-outline"
            onclick="closeCreateInstituteModal()"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">
            Create Institute
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Dashboard-specific JavaScript
  document.addEventListener("DOMContentLoaded", function () {
    // Dashboard tabs functionality
    const dashboardTabs = document.querySelectorAll(".dashboard-tab");
    const dashboardTabContents = document.querySelectorAll(
      ".dashboard-tab-content"
    );

    dashboardTabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        const tabId = tab.getAttribute("data-dashboard-tab");

        // Remove active class from all dashboard tabs and contents
        dashboardTabs.forEach((t) => t.classList.remove("active"));
        dashboardTabContents.forEach((content) =>
          content.classList.remove("active")
        );

        // Add active class to clicked dashboard tab and corresponding content
        tab.classList.add("active");
        document.getElementById(`dashboard-${tabId}`).classList.add("active");
      });
    });

    // Institute creation functionality
    const createInstituteForm = document.getElementById("createInstituteForm");
    if (createInstituteForm) {
      createInstituteForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        const formData = new FormData(this);
        const instituteData = {
          name: formData.get("name"),
          description: formData.get("description"),
          director: formData.get("director"),
          contactEmail: formData.get("contactEmail"),
        };

        // Validate required fields
        if (!instituteData.name.trim()) {
          alert("Institute name is required");
          return;
        }

        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;

        try {
          submitBtn.textContent = "Creating...";
          submitBtn.disabled = true;

          const response = await fetch(
            `/universities/<%= university._id %>/institutes`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(instituteData),
            }
          );

          const result = await response.json();

          if (response.ok) {
            alert("Institute created successfully!");
            closeCreateInstituteModal();
            // Refresh the page to show the new institute
            window.location.reload();
          } else {
            alert(result.error || "Failed to create institute");
          }
        } catch (error) {
          console.error("Error creating institute:", error);
          alert("Error creating institute. Please try again.");
        } finally {
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        }
      });

      // Character count for institute name
      const instituteName = document.getElementById("instituteName");
      const nameCount = document.getElementById("instituteNameCount");
      if (instituteName && nameCount) {
        instituteName.addEventListener("input", function () {
          const length = this.value.length;
          nameCount.textContent = `${length}/100 characters`;
          nameCount.style.color = length > 100 ? "#e74c3c" : "#666";
        });
      }

      // Character count for institute description
      const instituteDescription = document.getElementById(
        "instituteDescription"
      );
      const descCount = document.getElementById("instituteDescriptionCount");
      if (instituteDescription && descCount) {
        instituteDescription.addEventListener("input", function () {
          const length = this.value.length;
          descCount.textContent = `${length}/500 characters`;
          descCount.style.color = length > 500 ? "#e74c3c" : "#666";
        });
      }
    }

    // Close modal when clicking outside
    const modal = document.getElementById("createInstituteModal");
    if (modal) {
      window.addEventListener("click", function (e) {
        if (e.target === modal) {
          closeCreateInstituteModal();
        }
      });
    }
  });

  // Dashboard functions
  function showMemberManagement() {
    alert("Member management feature coming soon!");
    // This would open a modal or navigate to a member management page
  }

  function showInviteModal() {
    const inviteCode = "<%= university.inviteCode || 'N/A' %>";
    alert(
      `Invite Code: ${inviteCode}\n\nShare this code with others to join your university!`
    );
    // This would open a modal with invite options
  }

  function exportMemberData() {
    alert("Export feature coming soon!");
    // This would generate and download a CSV of member data
  }

  function showUniversitySettings() {
    alert("University settings feature coming soon!");
    // This would open a modal with university settings
  }

  function showDeleteModal() {
    const confirmed = confirm(
      "WARNING: This will permanently delete the university and all its data. This action cannot be undone. Are you sure?"
    );
    if (confirmed) {
      alert("Delete university feature coming soon!");
      // This would call an API to delete the university
    }
  }

  // Institute creation functions
  function createNewInstitute() {
    const modal = document.getElementById("createInstituteModal");
    if (modal) {
      modal.style.display = "block";
      document.getElementById("createInstituteForm").reset();

      // Reset character counts
      document.getElementById("instituteNameCount").textContent =
        "0/100 characters";
      document.getElementById("instituteDescriptionCount").textContent =
        "0/500 characters";
    }
  }

  function closeCreateInstituteModal() {
    const modal = document.getElementById("createInstituteModal");
    if (modal) {
      modal.style.display = "none";
    }
  }

  function manageInstitutes() {
    alert("Manage institutes feature coming soon!");
    // This would show a list of institutes with edit/delete options
  }

  function viewInstituteAnalytics() {
    alert("Institute analytics feature coming soon!");
    // This would show detailed analytics for institutes
  }

  function createNewCourse() {
    alert("Create new course feature coming soon!");
    // This would open a modal or form to create a new course
  }

  function manageCourses() {
    alert("Manage courses feature coming soon!");
    // This would show a list of courses with edit/delete options
  }

  function viewCourseAnalytics() {
    alert("Course analytics feature coming soon!");
    // This would show detailed analytics for courses
  }
</script>
