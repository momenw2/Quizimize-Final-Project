<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title><%= group.name %> - Group Details</title>
    <style>
      .container {
        max-width: 1200px;
        margin: auto;
        padding: 20px;
        font-family: Arial, sans-serif;
      }
      .main-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
      }
      .header-section {
        grid-column: 1 / -1;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 20px;
        margin-bottom: 20px;
        border-bottom: 2px solid #eee;
        padding-bottom: 20px;
      }
      .group-summary {
        flex-grow: 1;
      }
      .group-title {
        font-size: 28px;
        font-weight: bold;
        color: oklch(44.8% 0.119 151.328);
        margin: 0;
      }
      .group-meta {
        font-size: 14px;
        color: #555;
        margin-top: 5px;
      }
      .back-btn {
        background: #6b7280;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        text-decoration: none;
        font-size: 14px;
        align-self: flex-end;
      }
      .back-btn:hover {
        background: #4b5563;
      }
      .content-area {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      .tabs {
        display: flex;
        gap: 10px;
        border-bottom: 2px solid #ddd;
      }
      .tab-btn {
        padding: 10px 15px;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        color: #666;
        transition: color 0.3s, border-bottom 0.3s;
      }
      .tab-btn:hover,
      .tab-btn.active {
        color: oklch(44.8% 0.119 151.328);
        border-bottom: 2px solid oklch(44.8% 0.119 151.328);
      }
      .tab-content {
        padding: 20px;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        min-height: 400px;
      }
      .side-panel {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      .members-section {
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        padding: 20px;
      }
      .members-list {
        display: grid;
        gap: 10px;
      }
      .member-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        background: #f9fafb;
      }
      .member-info h4 {
        margin: 0;
        color: #111827;
      }
      .member-info p {
        margin: 0;
        font-size: 12px;
        color: #6b7280;
      }
      .member-role {
        background: oklch(44.8% 0.119 151.328);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
      }
      .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        text-decoration: none;
        display: inline-block;
        text-align: center;
      }
      .btn-primary {
        background: oklch(44.8% 0.119 151.328);
        color: white;
      }
      .btn-outline {
        background: white;
        color: oklch(44.8% 0.119 151.328);
        border: 1px solid oklch(44.8% 0.119 151.328);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header-section">
        <div class="group-summary">
          <h1 class="group-title"><%= group.name %></h1>
          <p class="group-meta">
            Level: <%= group.level || 1 %> | Members: <%= group.members.length
            %>
          </p>
          <p class="group-meta">Specialization: <%= group.specialization %></p>
          <p class="group-meta">
            Created: <%= new Date(group.createdAt).toLocaleDateString() %>
          </p>
        </div>
        <a href="/groups" class="back-btn">‚Üê Back to Groups</a>
      </div>

      <div class="main-grid">
        <div class="content-area">
          <div class="tabs">
            <button class="tab-btn active" onclick="showTab('timeline')">
              Timeline
            </button>
            <button class="tab-btn" onclick="showTab('missions')">
              Missions
            </button>
            <button class="tab-btn" onclick="showTab('stats')">Stats</button>
          </div>
          <div id="timeline" class="tab-content">
            <h3>Timeline</h3>
            <p>Here you will see a feed of group activities and updates.</p>
          </div>
          <div id="missions" class="tab-content" style="display: none">
            <h3>Missions</h3>
            <p>This is where group missions and quests will be displayed.</p>
          </div>
          <div id="stats" class="tab-content" style="display: none">
            <h3>Stats</h3>
            <p>
              This section will show detailed group statistics and analytics.
            </p>
          </div>
        </div>

        <div class="side-panel">
          <div class="members-section">
            <h3>Members (<%= group.members.length %>)</h3>
            <% if (group.members && group.members.length > 0) { %>
            <div class="members-list">
              <% group.members.forEach(function(member, index) { %>
              <div class="member-card">
                <div class="member-info">
                  <h4>
                    <% if (member.user && member.user.username) { %> <%=
                    member.user.username %> <% } else { %> User <%= index + 1 %>
                    <% } %>
                  </h4>
                  <p>
                    <% if (member.user && member.user.email) { %> <%=
                    member.user.email %> <% } else { %> ID: <%=
                    member.user._id.toString().slice(-6) %> <% } %>
                  </p>
                </div>
                <span class="member-role"><%= member.role %></span>
              </div>
              <% }); %>
            </div>
            <% } else { %>
            <p style="text-align: center; color: #666; font-style: italic">
              No members yet.
            </p>
            <% } %>
            <div class="action-buttons" style="margin-top: 20px">
              <button class="btn btn-primary" onclick="inviteMember()">
                Invite Member
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      function showTab(tabId) {
        const tabs = document.querySelectorAll(".tab-content");
        tabs.forEach((tab) => {
          tab.style.display = "none";
        });

        const buttons = document.querySelectorAll(".tab-btn");
        buttons.forEach((btn) => {
          btn.classList.remove("active");
        });

        document.getElementById(tabId).style.display = "block";
        event.currentTarget.classList.add("active");
      }

      function inviteMember() {
        // Your existing inviteMember function logic
        const groupCode = "<%= group._id.toString().slice(-8).toUpperCase() %>";
        const inviteLink =
          window.location.origin + "/groups/join?code=" + groupCode;

        if (navigator.clipboard) {
          navigator.clipboard
            .writeText(inviteLink)
            .then(() => {
              alert(
                "Invite link copied to clipboard!\n\nGroup Code: " + groupCode
              );
            })
            .catch(() => {
              alert(
                "Group Code: " + groupCode + "\nInvite Link: " + inviteLink
              );
            });
        } else {
          alert("Group Code: " + groupCode + "\nInvite Link: " + inviteLink);
        }
      }
    </script>
  </body>
</html>
